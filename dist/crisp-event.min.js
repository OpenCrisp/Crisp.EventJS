/*! OpenCrisp EventJS - v0.1.6 - 2015-08-02
* http://opencrisp.wca.at
* Copyright (c) 2015 Fabian Schmid; Licensed MIT */
!function(a){function b(a){var b;if(void 0!==a)return j(a,"RegExp")?a:(b=a.split(" "),b.map(function(a){return i(a)}),new RegExp("^("+b.join("|")+")\\.?"))}function c(a){var b;if(void 0!==a)return j(a,"RegExp")?a:(b=a.split(" "),b.map(function(a){return i(a)}),new RegExp("^("+b.join("|")+")$"))}function d(){this._list={}}function e(a,b,c,e,f,g){this.self=a,this.picker=b,this.action=c,this.treat=e,this.path=f,this._empty=g,this.wait=1,this.repeat=!0,this.note=new d}function f(a){this._listen=a.listen,this._self=a.self,this._async=a.async,this._action=b(a.action),this._path=c(a.path),this._noteAction=b(a.noteAction),this._notePath=c(a.notePath),this._noteList=a.noteList||k}function g(){this._listener=[]}var h=a.utilTick,i=RegExp.escape,j=a.isType,k="own",l="task";d.prototype={List:function(a){return a=a||k,this._list[a]=this._list[a]||[]},Length:function(a){var b,c=0;if(void 0!==a);else for(b in this._list)c+=this._list[b].length;return c},Empty:function(a){return 0===this.Length(a)},Add:function(a,b){this.List(a.type||b).push(a)}},e.prototype={Wait:function(){return this.wait+=1,this},Talk:function(){return this.wait-=1,this.wait>0||!this._empty&&this.note.Empty()?this:(delete this.picker[this.treat],this.self.eventTrigger(this),this)},Note:function(a,b){return this.note.Add(a,b),this},Test:function(a){var b=0;return this.note.List(a._noteList).forEach(function(c){var d=0;a._notePath&&!a._notePath.test(c.path)&&(d+=1),a._noteAction&&!a._noteAction.test(c.action)&&(d+=1),0===d&&(b+=1)}),0===b}},f.prototype={talk:function(a){this._self!==a.exporter&&(!this._action||this._action.test(a.action))&&(!this._path||this._path.test(a.path))&&(!this._notePath&&!this._noteAction||a instanceof e&&!a.Test(this))&&h(this._self,this._listen,a,this._async)},is:function(a){var c;return c=this._action&&a.action?this._action.toString()===b(a.action).toString():void 0===this._action||void 0===a.action,this._listen===a.listen&&c}},g.prototype={add:function(a){for(var b,c=this._listener,d=0,e=c.length;e>d;d+=1)if(c[d].is(a))return c[d];return b=new f(a),c.push(b),b},trigger:function(a){for(var b=this._listener,c=0,d=b.length;d>c;c+=1)b[c].talk(a);return this},remove:function(a){for(var b=this._listener,c=0,d=b.length;d>c;c+=1)if(b[c]===a){b.splice(c,1);break}return this}},a.defineEvent=function(b,c){return c=c||{},c.event=c.event||"__event__",c.parent=c.parent||"__parent__",Object.defineProperty(b,c.event,{writabel:!0,value:new g}),Object.defineProperties(b,{eventListener:{value:function(a){return a.self=a.self||this,this[c.event].add(a)}},eventTrigger:{value:function(b){var d;return b=b||{},b.self=b.self||this,d=this[c.parent],this[c.event].trigger(b),b.repeat&&d&&a.isType(d.eventTrigger,"Function")&&d.eventTrigger(b),this}},eventPicker:{value:function(a){var b,c,d;return c=a.cache.picker=a.cache.picker||{},b=a.action||l,d=b.split(".")[0],c[d]instanceof e?c[d].Wait():c[d]=new e(this,c,b,d,a.path,a.empty)}},eventRemove:{value:function(a){return this[c.event].remove(a),this}}}),b}}(Crisp);